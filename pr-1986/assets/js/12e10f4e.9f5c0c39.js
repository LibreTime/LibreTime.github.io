"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1599],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),l=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(a),m=r,h=d["".concat(p,".").concat(m)]||d[m]||c[m]||o;return a?n.createElement(h,i(i({ref:t},u),{},{components:a})):n.createElement(h,i({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},93852:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var n=a(87462),r=(a(67294),a(3905));const o={title:"Backup",sidebar_position:10},i=void 0,s={unversionedId:"admin-manual/backup",id:"admin-manual/backup",title:"Backup",description:"Create a backup",source:"@site/../docs/admin-manual/backup.md",sourceDirName:"admin-manual",slug:"/admin-manual/backup",permalink:"/pr-1986/docs/next/admin-manual/backup",draft:!1,editUrl:"https://github.com/libretime/libretime/blob/main/docs/../docs/admin-manual/backup.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{title:"Backup",sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"Migrate from Airtime",permalink:"/pr-1986/docs/next/admin-manual/setup/migrate-from-airtime"},next:{title:"Library management",permalink:"/pr-1986/docs/next/admin-manual/library"}},p={},l=[{value:"Create a backup",id:"create-a-backup",level:2},{value:"Backup the configuration",id:"backup-the-configuration",level:3},{value:"Backup the database",id:"backup-the-database",level:3},{value:"Backup the storage",id:"backup-the-storage",level:3},{value:"Restore a backup",id:"restore-a-backup",level:2},{value:"Install or cleanup",id:"install-or-cleanup",level:3},{value:"Restore the configuration",id:"restore-the-configuration",level:3},{value:"Restore the database",id:"restore-the-database",level:3},{value:"Restore the storage",id:"restore-the-storage",level:3}],u={toc:l};function c(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"create-a-backup"},"Create a backup"),(0,r.kt)("p",null,"This guide walk you though the steps required to create a full backup of your installation."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Remember to ",(0,r.kt)("strong",{parentName:"p"},"automate")," and ",(0,r.kt)("strong",{parentName:"p"},"test")," the backup process and to have it run regularly. Having an ",(0,r.kt)("strong",{parentName:"p"},"automated")," and ",(0,r.kt)("strong",{parentName:"p"},"tested")," restoring process is also recommended.")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Feel free to pick the backup software of your choice, but know that rsync and similar tools are not backup tools. You could use ",(0,r.kt)("a",{parentName:"p",href:"https://restic.net/"},"restic")," or ",(0,r.kt)("a",{parentName:"p",href:"https://borgbackup.readthedocs.io/"},"borg"),".")),(0,r.kt)("h3",{id:"backup-the-configuration"},"Backup the configuration"),(0,r.kt)("p",null,"On common setups, you need to backup the entire ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/libretime")," folder."),(0,r.kt)("h3",{id:"backup-the-database"},"Backup the database"),(0,r.kt)("p",null,"You need to backup the PostgreSQL database, which holds the entire data of your installation."),(0,r.kt)("p",null,"Here is an example to dump your PostgreSQL database:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo -u postgres pg_dump --file=libretime.sql libretime\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Consider using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--no-owner")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"--no-privileges")," flags to ignore roles\nand permissions details about the database. This can be useful when restoring\nto database or role that have different names.")),(0,r.kt)("p",null,"Please read the ",(0,r.kt)("inlineCode",{parentName:"p"},"pg_dump")," usage for additional details."),(0,r.kt)("h3",{id:"backup-the-storage"},"Backup the storage"),(0,r.kt)("p",null,"You need to backup the entire file storage, which holds all the files of your installation."),(0,r.kt)("p",null,"The path to your storage is defined in the ",(0,r.kt)("a",{parentName:"p",href:"/pr-1986/docs/next/admin-manual/setup/configuration"},"configuration")," file."),(0,r.kt)("h2",{id:"restore-a-backup"},"Restore a backup"),(0,r.kt)("h3",{id:"install-or-cleanup"},"Install or cleanup"),(0,r.kt)("p",null,"If you are restoring a backup on a fresh system, we recommend that you first ",(0,r.kt)("a",{parentName:"p",href:"/pr-1986/docs/next/admin-manual/setup/install"},"install LibreTime"),", and ",(0,r.kt)("strong",{parentName:"p"},"stop before the ",(0,r.kt)("a",{parentName:"strong",href:"/pr-1986/docs/next/admin-manual/setup/install#setup"},"setup tasks")),"."),(0,r.kt)("p",null,"If you are restoring a backup on an existing system, make sure to clean the old ",(0,r.kt)("strong",{parentName:"p"},"database")," and ",(0,r.kt)("strong",{parentName:"p"},"files storage"),"."),(0,r.kt)("h3",{id:"restore-the-configuration"},"Restore the configuration"),(0,r.kt)("p",null,"Copy the backed configuration files back to the ",(0,r.kt)("a",{parentName:"p",href:"/pr-1986/docs/next/admin-manual/setup/configuration"},"configuration")," folder."),(0,r.kt)("p",null,"If you are upgrading LibreTime, edit the configuration file to match the new configuration schema and update any changed values. See the ",(0,r.kt)("a",{parentName:"p",href:"/pr-1986/docs/next/admin-manual/setup/configuration"},"configuration")," documentation for more details."),(0,r.kt)("h3",{id:"restore-the-database"},"Restore the database"),(0,r.kt)("p",null,"Restore the database by using the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo -u postgres pg_restore --dbname=libretime libretime.sql\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Consider using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--no-owner")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"--no-privileges")," flags to ignore roles\nand permissions details about the database. This can be useful when restoring\nto database or role that have different names.")),(0,r.kt)("p",null,"If you are upgrading LibreTime, make sure to apply the ",(0,r.kt)("a",{parentName:"p",href:"/pr-1986/docs/next/admin-manual/setup/upgrade#apply-migrations"},"database migration"),"."),(0,r.kt)("h3",{id:"restore-the-storage"},"Restore the storage"),(0,r.kt)("p",null,"Copy the entire backed file storage back to the storage path."),(0,r.kt)("p",null,"The path to your storage is defined in the ",(0,r.kt)("a",{parentName:"p",href:"/pr-1986/docs/next/admin-manual/setup/configuration"},"configuration")," file."))}c.isMDXComponent=!0}}]);